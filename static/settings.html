<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" id="tab-favicon" href="favicon.png" />
  <title id="t">Settings</title>
  <link rel="stylesheet" id="global" href="/assets/css/global.css?v=6" />
  <link rel="stylesheet" href="/assets/css/container.css?v=2" />
  <link rel="stylesheet" href="/assets/css/settings.css?v=06" />
</head>

<body>
  <nav style="padding: 20px; text-align: center;">
    <a href="/" style="margin: 0 15px; text-decoration: none; color: #fff;">Home</a>
    <a href="/games.html" style="margin: 0 15px; text-decoration: none; color: #fff;">Games</a>
    <a href="/settings.html" style="margin: 0 15px; text-decoration: none; color: #fff;">Settings</a>
    <a href="/tabs.html" style="margin: 0 15px; text-decoration: none; color: #fff;">Proxy</a>
  </nav>
  
  <div class="main">
    <div class="settings-container">
      <div class="settings-card">
        <h3>Search Engine</h3>
        <p>Change the search engine when searching.</p>
        <select title="engine" id="engine" onchange="EngineChange(this)">
          <option value="Google">Google (Default)</option>
          <option value="Bing">Bing</option>
          <option value="DuckDuckGo">DuckDuckGo</option>
          <option value="Qwant">Qwant</option>
          <option value="Startpage">Startpage</option>
          <option value="SearchEncrypt">SearchEncrypt</option>
          <option value="Ecosia">Ecosia</option>
        </select>
        <input class="key-form" type="text" id="engine-form" placeholder="Change Search Engine" name="engine" />
        <button class="key-button" value="Save" onclick="SaveEngine();">
          Save
        </button>
      </div>
      <div class="settings-card">
        <h3>Choose your Proxy</h3>
        <p>
          Ultraviolet is the main proxy, but Dynamic is
          faster and supports more sites. (Dynamic is still in beta, so expect
          some bugs.)
        </p>
        <select id="pChange">
          <option value="uv">Ultraviolet (Default)</option>
          <option value="dy">Dynamic (Doesn't work in about:blank)</option>
        </select>
      </div>
      <div class="settings-card">
        <h3>JS Injection</h3>
        <p>Inject external JavaScript files into specific websites. Edit the config file to add custom injections.</p>
        <div id="js-injection-list">
          <p>Loading configurations...</p>
        </div>
        <button class="key-button" onclick="reloadInjectionConfig()">Reload Config</button>
        <p style="font-size: 12px; margin-top: 10px;">
          Config file location: <code>/js-injection-config.json</code><br>
          Edit the file directly to add new injection rules.
        </p>
      </div>
    </div>
  </div>
  <script src="/assets/js/006.js?v=000"></script>
  <script src="/assets/js/js-injection.js"></script>
  <script>
    // Display current injection configurations
    async function displayInjectionConfig() {
      try {
        const response = await fetch('/js-injection-config.json');
        const config = await response.json();
        const listElement = document.getElementById('js-injection-list');
        
        if (!config.injections || config.injections.length === 0) {
          listElement.innerHTML = '<p>No injection rules configured.</p>';
          return;
        }

        let html = '<div style="max-height: 300px; overflow-y: auto;">';
        config.injections.forEach((injection, index) => {
          const statusClass = injection.enabled ? 'enabled' : 'disabled';
          html += `
            <div style="border: 1px solid #333; margin: 5px 0; padding: 10px; border-radius: 5px;">
              <h4 style="margin: 0 0 5px 0; color: ${injection.enabled ? '#4CAF50' : '#f44336'};">
                ${injection.name} (${injection.enabled ? 'Enabled' : 'Disabled'})
              </h4>
              <p style="margin: 5px 0; font-size: 12px;">
                <strong>URL Pattern:</strong> ${injection.url_pattern}
              </p>
              <p style="margin: 5px 0; font-size: 12px;">
                <strong>Scripts:</strong><br>
                ${injection.js_urls.map(url => `â€¢ ${url}`).join('<br>')}
              </p>
            </div>
          `;
        });
        html += '</div>';
        
        listElement.innerHTML = html;
      } catch (error) {
        document.getElementById('js-injection-list').innerHTML =
          '<p style="color: #f44336;">Failed to load configuration.</p>';
      }
    }

    function reloadInjectionConfig() {
      if (window.jsInjector) {
        window.jsInjector.loadConfig();
      }
      displayInjectionConfig();
    }

    // Load config on page load
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(displayInjectionConfig, 500);
    });
  </script>
</body>

</html>